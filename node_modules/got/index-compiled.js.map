{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\n\nvar EventEmitter = require('events').EventEmitter;\nvar http = require('http');\nvar https = require('https');\nvar urlLib = require('url');\nvar querystring = require('querystring');\nvar objectAssign = require('object-assign');\nvar PassThrough = require('readable-stream').PassThrough;\nvar duplexer2 = require('duplexer2');\nvar isStream = require('is-stream');\nvar readAllStream = require('read-all-stream');\nvar timedOut = require('timed-out');\nvar urlParseLax = require('url-parse-lax');\nvar lowercaseKeys = require('lowercase-keys');\nvar isRedirect = require('is-redirect');\nvar PinkiePromise = require('pinkie-promise');\nvar unzipResponse = require('unzip-response');\nvar createErrorClass = require('create-error-class');\nvar nodeStatusCodes = require('node-status-codes');\nvar parseJson = require('parse-json');\nvar isRetryAllowed = require('is-retry-allowed');\nvar pkg = require('./package.json');\n\nfunction requestAsEventEmitter(opts) {\n\topts = opts || {};\n\n\tvar ee = new EventEmitter();\n\tvar requestUrl = opts.href || urlLib.resolve(urlLib.format(opts), opts.path);\n\tvar redirectCount = 0;\n\tvar retryCount = 0;\n\tvar redirectUrl;\n\n\tvar get = function (opts) {\n\t\tvar fn = opts.protocol === 'https:' ? https : http;\n\n\t\tvar req = fn.request(opts, function (res) {\n\t\t\tvar statusCode = res.statusCode;\n\n\t\t\tif (isRedirect(statusCode) && opts.followRedirect && 'location' in res.headers && (opts.method === 'GET' || opts.method === 'HEAD')) {\n\t\t\t\tres.resume();\n\n\t\t\t\tif (++redirectCount > 10) {\n\t\t\t\t\tee.emit('error', new got.MaxRedirectsError(statusCode, opts), null, res);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tredirectUrl = urlLib.resolve(urlLib.format(opts), res.headers.location);\n\t\t\t\tvar redirectOpts = objectAssign({}, opts, urlLib.parse(redirectUrl));\n\n\t\t\t\tee.emit('redirect', res, redirectOpts);\n\n\t\t\t\tget(redirectOpts);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// do not write ee.bind(...) instead of function - it will break gzip in Node.js 0.10\n\t\t\tsetImmediate(function () {\n\t\t\t\tvar response = typeof unzipResponse === 'function' && req.method !== 'HEAD' ? unzipResponse(res) : res;\n\t\t\t\tresponse.url = redirectUrl || requestUrl;\n\t\t\t\tresponse.requestUrl = requestUrl;\n\n\t\t\t\tee.emit('response', response);\n\t\t\t});\n\t\t});\n\n\t\treq.once('error', function (err) {\n\t\t\tvar backoff = opts.retries(++retryCount, err);\n\t\t\tif (backoff) {\n\t\t\t\tsetTimeout(get, backoff, opts);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tee.emit('error', new got.RequestError(err, opts));\n\t\t});\n\n\t\tif (opts.timeout) {\n\t\t\ttimedOut(req, opts.timeout);\n\t\t}\n\n\t\tsetImmediate(ee.emit.bind(ee), 'request', req);\n\t};\n\n\tget(opts);\n\treturn ee;\n}\n\nfunction asCallback(opts, cb) {\n\tvar ee = requestAsEventEmitter(opts);\n\n\tee.on('request', function (req) {\n\t\tif (isStream(opts.body)) {\n\t\t\topts.body.pipe(req);\n\t\t\topts.body = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\treq.end(opts.body);\n\t});\n\n\tee.on('response', function (res) {\n\t\treadAllStream(res, opts.encoding, function (error, data) {\n\t\t\tvar statusCode = res.statusCode;\n\t\t\tvar limitStatusCode = opts.followRedirect ? 299 : 399;\n\n\t\t\tif (error) {\n\t\t\t\tcb(new got.ReadError(error, opts), null, res);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (statusCode < 200 || statusCode > limitStatusCode) {\n\t\t\t\terror = new got.HTTPError(statusCode, opts);\n\t\t\t}\n\n\t\t\tif (opts.json && data) {\n\t\t\t\ttry {\n\t\t\t\t\tdata = parseJson(data);\n\t\t\t\t} catch (err) {\n\t\t\t\t\terr.fileName = urlLib.format(opts);\n\t\t\t\t\terror = new got.ParseError(err, statusCode, opts);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcb(error, data, res);\n\t\t});\n\t});\n\n\tee.on('error', cb);\n}\n\nfunction asPromise(opts) {\n\treturn new PinkiePromise(function (resolve, reject) {\n\t\tasCallback(opts, function (err, data, response) {\n\t\t\tif (response) {\n\t\t\t\tresponse.body = data;\n\t\t\t}\n\n\t\t\tif (err) {\n\t\t\t\tObject.defineProperty(err, 'response', {\n\t\t\t\t\tvalue: response,\n\t\t\t\t\tenumerable: false\n\t\t\t\t});\n\t\t\t\treject(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tresolve(response);\n\t\t});\n\t});\n}\n\nfunction asStream(opts) {\n\tvar input = new PassThrough();\n\tvar output = new PassThrough();\n\tvar proxy = duplexer2(input, output);\n\n\tif (opts.json) {\n\t\tthrow new Error('got can not be used as stream when options.json is used');\n\t}\n\n\tif (opts.body) {\n\t\tproxy.write = function () {\n\t\t\tthrow new Error('got\\'s stream is not writable when options.body is used');\n\t\t};\n\t}\n\n\tvar ee = requestAsEventEmitter(opts);\n\n\tee.on('request', function (req) {\n\t\tproxy.emit('request', req);\n\n\t\tif (isStream(opts.body)) {\n\t\t\topts.body.pipe(req);\n\t\t\treturn;\n\t\t}\n\n\t\tif (opts.body) {\n\t\t\treq.end(opts.body);\n\t\t\treturn;\n\t\t}\n\n\t\tif (opts.method === 'POST' || opts.method === 'PUT' || opts.method === 'PATCH') {\n\t\t\tinput.pipe(req);\n\t\t\treturn;\n\t\t}\n\n\t\treq.end();\n\t});\n\n\tee.on('response', function (res) {\n\t\tvar statusCode = res.statusCode;\n\t\tvar limitStatusCode = opts.followRedirect ? 299 : 399;\n\n\t\tres.pipe(output);\n\n\t\tif (statusCode < 200 || statusCode > limitStatusCode) {\n\t\t\tproxy.emit('error', new got.HTTPError(statusCode, opts), null, res);\n\t\t\treturn;\n\t\t}\n\n\t\tproxy.emit('response', res);\n\t});\n\n\tee.on('redirect', proxy.emit.bind(proxy, 'redirect'));\n\n\tee.on('error', proxy.emit.bind(proxy, 'error'));\n\n\treturn proxy;\n}\n\nfunction normalizeArguments(url, opts) {\n\tif (typeof url !== 'string' && typeof url !== 'object') {\n\t\tthrow new Error('Parameter `url` must be a string or object, not ' + typeof url);\n\t}\n\n\tif (typeof url === 'string') {\n\t\turl = url.replace(/^unix:/, 'http://$&');\n\t\turl = urlParseLax(url);\n\n\t\tif (url.auth) {\n\t\t\tthrow new Error('Basic authentication must be done with auth option');\n\t\t}\n\t}\n\n\topts = objectAssign(\n\t\t{protocol: 'http:', path: '', retries: 5},\n\t\turl,\n\t\topts\n\t);\n\n\topts.headers = objectAssign({\n\t\t'user-agent': pkg.name + '/' + pkg.version + ' (https://github.com/sindresorhus/got)',\n\t\t'accept-encoding': 'gzip,deflate'\n\t}, lowercaseKeys(opts.headers));\n\n\tvar query = opts.query;\n\n\tif (query) {\n\t\tif (typeof query !== 'string') {\n\t\t\topts.query = querystring.stringify(query);\n\t\t}\n\n\t\topts.path = opts.path.split('?')[0] + '?' + opts.query;\n\t\tdelete opts.query;\n\t}\n\n\tif (opts.json && opts.headers.accept === undefined) {\n\t\topts.headers.accept = 'application/json';\n\t}\n\n\tvar body = opts.body;\n\n\tif (body) {\n\t\tif (typeof body !== 'string' && !(body !== null && typeof body === 'object')) {\n\t\t\tthrow new Error('options.body must be a ReadableStream, string, Buffer or plain Object');\n\t\t}\n\n\t\topts.method = opts.method || 'POST';\n\n\t\tif (isStream(body) && typeof body.getBoundary === 'function') {\n\t\t\t// Special case for https://github.com/form-data/form-data\n\t\t\topts.headers['content-type'] = opts.headers['content-type'] || 'multipart/form-data; boundary=' + body.getBoundary();\n\t\t} else if (body !== null && typeof body === 'object' && !Buffer.isBuffer(body) && !isStream(body)) {\n\t\t\topts.headers['content-type'] = opts.headers['content-type'] || 'application/x-www-form-urlencoded';\n\t\t\tbody = opts.body = querystring.stringify(body);\n\t\t}\n\n\t\tif (opts.headers['content-length'] === undefined && opts.headers['transfer-encoding'] === undefined && !isStream(body)) {\n\t\t\tvar length = typeof body === 'string' ? Buffer.byteLength(body) : body.length;\n\t\t\topts.headers['content-length'] = length;\n\t\t}\n\t}\n\n\topts.method = opts.method || 'GET';\n\n\topts.method = opts.method.toUpperCase();\n\n\tif (opts.hostname === 'unix') {\n\t\tvar matches = /(.+):(.+)/.exec(opts.path);\n\n\t\tif (matches) {\n\t\t\topts.socketPath = matches[1];\n\t\t\topts.path = matches[2];\n\t\t\topts.host = null;\n\t\t}\n\t}\n\n\tif (typeof opts.retries !== 'function') {\n\t\tvar retries = opts.retries;\n\t\topts.retries = function backoff(iter, err) {\n\t\t\tif (iter > retries || !isRetryAllowed(err)) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tvar noise = Math.random() * 100;\n\t\t\treturn ((1 << iter) * 1000) + noise;\n\t\t};\n\t}\n\n\tif (opts.followRedirect === undefined) {\n\t\topts.followRedirect = true;\n\t}\n\n\treturn opts;\n}\n\nfunction got(url, opts, cb) {\n\tif (typeof opts === 'function') {\n\t\tcb = opts;\n\t\topts = {};\n\t}\n\n\tif (cb) {\n\t\tasCallback(normalizeArguments(url, opts), cb);\n\t\treturn null;\n\t}\n\n\ttry {\n\t\treturn asPromise(normalizeArguments(url, opts));\n\t} catch (err) {\n\t\treturn PinkiePromise.reject(err);\n\t}\n}\n\nvar helpers = [\n\t'get',\n\t'post',\n\t'put',\n\t'patch',\n\t'head',\n\t'delete'\n];\n\nhelpers.forEach(function (el) {\n\tgot[el] = function (url, opts, cb) {\n\t\tif (typeof opts === 'function') {\n\t\t\tcb = opts;\n\t\t\topts = {};\n\t\t}\n\n\t\treturn got(url, objectAssign({}, opts, {method: el}), cb);\n\t};\n});\n\ngot.stream = function (url, opts, cb) {\n\tif (cb || typeof opts === 'function') {\n\t\tthrow new Error('callback can not be used with stream mode');\n\t}\n\n\treturn asStream(normalizeArguments(url, opts));\n};\n\nhelpers.forEach(function (el) {\n\tgot.stream[el] = function (url, opts, cb) {\n\t\tif (typeof opts === 'function') {\n\t\t\tcb = opts;\n\t\t\topts = {};\n\t\t}\n\n\t\treturn got.stream(url, objectAssign({}, opts, {method: el}), cb);\n\t};\n});\n\nfunction stdError(error, opts) {\n\tif (error.code !== undefined) {\n\t\tthis.code = error.code;\n\t}\n\n\tobjectAssign(this, {\n\t\tmessage: error.message,\n\t\thost: opts.host,\n\t\thostname: opts.hostname,\n\t\tmethod: opts.method,\n\t\tpath: opts.path\n\t});\n}\n\ngot.RequestError = createErrorClass('RequestError', stdError);\ngot.ReadError = createErrorClass('ReadError', stdError);\n\ngot.ParseError = createErrorClass('ParseError', function (e, statusCode, opts) {\n\tstdError.call(this, e, opts);\n\tthis.statusCode = statusCode;\n\tthis.statusMessage = nodeStatusCodes[this.statusCode];\n});\n\ngot.HTTPError = createErrorClass('HTTPError', function (statusCode, opts) {\n\tstdError.call(this, {}, opts);\n\tthis.statusCode = statusCode;\n\tthis.statusMessage = nodeStatusCodes[this.statusCode];\n\tthis.message = 'Response code ' + this.statusCode + ' (' + this.statusMessage + ')';\n});\n\ngot.MaxRedirectsError = createErrorClass('MaxRedirectsError', function (statusCode, opts) {\n\tstdError.call(this, {}, opts);\n\tthis.statusCode = statusCode;\n\tthis.statusMessage = nodeStatusCodes[this.statusCode];\n\tthis.message = 'Redirected 10 times. Aborting.';\n});\n\nmodule.exports = got;\n"]}