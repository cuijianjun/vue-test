{"version":3,"sources":["popup-manager.js"],"names":[],"mappings":"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","file":"popup-manager-compiled.js","sourcesContent":["'use strict';\n\nexports.__esModule = true;\n\nvar _vue = require('vue');\n\nvar _vue2 = _interopRequireDefault(_vue);\n\nvar _dom = require('element-ui/lib/utils/dom');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar hasModal = false;\n\nvar getModal = function getModal() {\n  if (_vue2.default.prototype.$isServer) return;\n  var modalDom = PopupManager.modalDom;\n  if (modalDom) {\n    hasModal = true;\n  } else {\n    hasModal = false;\n    modalDom = document.createElement('div');\n    PopupManager.modalDom = modalDom;\n\n    modalDom.addEventListener('touchmove', function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n    });\n\n    modalDom.addEventListener('click', function () {\n      PopupManager.doOnModalClick && PopupManager.doOnModalClick();\n    });\n  }\n\n  return modalDom;\n};\n\nvar instances = {};\n\nvar PopupManager = {\n  zIndex: 2000,\n\n  modalFade: true,\n\n  getInstance: function getInstance(id) {\n    return instances[id];\n  },\n\n  register: function register(id, instance) {\n    if (id && instance) {\n      instances[id] = instance;\n    }\n  },\n\n  deregister: function deregister(id) {\n    if (id) {\n      instances[id] = null;\n      delete instances[id];\n    }\n  },\n\n  nextZIndex: function nextZIndex() {\n    return PopupManager.zIndex++;\n  },\n\n  modalStack: [],\n\n  doOnModalClick: function doOnModalClick() {\n    var topItem = PopupManager.modalStack[PopupManager.modalStack.length - 1];\n    if (!topItem) return;\n\n    var instance = PopupManager.getInstance(topItem.id);\n    if (instance && instance.closeOnClickModal) {\n      instance.close();\n    }\n  },\n\n  openModal: function openModal(id, zIndex, dom, modalClass, modalFade) {\n    if (_vue2.default.prototype.$isServer) return;\n    if (!id || zIndex === undefined) return;\n    this.modalFade = modalFade;\n\n    var modalStack = this.modalStack;\n\n    for (var i = 0, j = modalStack.length; i < j; i++) {\n      var item = modalStack[i];\n      if (item.id === id) {\n        return;\n      }\n    }\n\n    var modalDom = getModal();\n\n    (0, _dom.addClass)(modalDom, 'v-modal');\n    if (this.modalFade && !hasModal) {\n      (0, _dom.addClass)(modalDom, 'v-modal-enter');\n    }\n    if (modalClass) {\n      var classArr = modalClass.trim().split(/\\s+/);\n      classArr.forEach(function (item) {\n        return (0, _dom.addClass)(modalDom, item);\n      });\n    }\n    setTimeout(function () {\n      (0, _dom.removeClass)(modalDom, 'v-modal-enter');\n    }, 200);\n\n    if (dom && dom.parentNode && dom.parentNode.nodeType !== 11) {\n      dom.parentNode.appendChild(modalDom);\n    } else {\n      document.body.appendChild(modalDom);\n    }\n\n    if (zIndex) {\n      modalDom.style.zIndex = zIndex;\n    }\n    modalDom.style.display = '';\n\n    this.modalStack.push({ id: id, zIndex: zIndex, modalClass: modalClass });\n  },\n\n  closeModal: function closeModal(id) {\n    var modalStack = this.modalStack;\n    var modalDom = getModal();\n\n    if (modalStack.length > 0) {\n      var topItem = modalStack[modalStack.length - 1];\n      if (topItem.id === id) {\n        if (topItem.modalClass) {\n          var classArr = topItem.modalClass.trim().split(/\\s+/);\n          classArr.forEach(function (item) {\n            return (0, _dom.removeClass)(modalDom, item);\n          });\n        }\n\n        modalStack.pop();\n        if (modalStack.length > 0) {\n          modalDom.style.zIndex = modalStack[modalStack.length - 1].zIndex;\n        }\n      } else {\n        for (var i = modalStack.length - 1; i >= 0; i--) {\n          if (modalStack[i].id === id) {\n            modalStack.splice(i, 1);\n            break;\n          }\n        }\n      }\n    }\n\n    if (modalStack.length === 0) {\n      if (this.modalFade) {\n        (0, _dom.addClass)(modalDom, 'v-modal-leave');\n      }\n      setTimeout(function () {\n        if (modalStack.length === 0) {\n          if (modalDom.parentNode) modalDom.parentNode.removeChild(modalDom);\n          modalDom.style.display = 'none';\n          PopupManager.modalDom = undefined;\n        }\n        (0, _dom.removeClass)(modalDom, 'v-modal-leave');\n      }, 200);\n    }\n  }\n};\n\nvar getTopPopup = function getTopPopup() {\n  if (_vue2.default.prototype.$isServer) return;\n  if (PopupManager.modalStack.length > 0) {\n    var topPopup = PopupManager.modalStack[PopupManager.modalStack.length - 1];\n    if (!topPopup) return;\n    var instance = PopupManager.getInstance(topPopup.id);\n\n    return instance;\n  }\n};\n\nif (!_vue2.default.prototype.$isServer) {\n  // handle `esc` key when the popup is shown\n  window.addEventListener('keydown', function (event) {\n    if (event.keyCode === 27) {\n      var topPopup = getTopPopup();\n\n      if (topPopup && topPopup.closeOnPressEscape) {\n        topPopup.handleClose ? topPopup.handleClose() : topPopup.handleAction ? topPopup.handleAction('cancel') : topPopup.close();\n      }\n    }\n  });\n}\n\nexports.default = PopupManager;"]}