{"version":3,"sources":["popup-manager.js"],"names":[],"mappings":"AAAA,OAAO,GAAP,MAAgB,KAAhB;AACA,SAAS,QAAT,EAAmB,WAAnB,QAAsC,0BAAtC;;AAEA,IAAI,WAAW,KAAf;;AAEA,IAAM,WAAW,SAAX,QAAW,GAAW;AAC1B,MAAI,IAAI,SAAJ,CAAc,SAAlB,EAA6B;AAC7B,MAAI,WAAW,aAAa,QAA5B;AACA,MAAI,QAAJ,EAAc;AACZ,eAAW,IAAX;AACD,GAFD,MAEO;AACL,eAAW,KAAX;AACA,eAAW,SAAS,aAAT,CAAuB,KAAvB,CAAX;AACA,iBAAa,QAAb,GAAwB,QAAxB;;AAEA,aAAS,gBAAT,CAA0B,WAA1B,EAAuC,UAAS,KAAT,EAAgB;AACrD,YAAM,cAAN;AACA,YAAM,eAAN;AACD,KAHD;;AAKA,aAAS,gBAAT,CAA0B,OAA1B,EAAmC,YAAW;AAC5C,mBAAa,cAAb,IAA+B,aAAa,cAAb,EAA/B;AACD,KAFD;AAGD;;AAED,SAAO,QAAP;AACD,CArBD;;AAuBA,IAAM,YAAY,EAAlB;;AAEA,IAAM,eAAe;AACnB,UAAQ,IADW;;AAGnB,aAAW,IAHQ;;AAKnB,eAAa,qBAAS,EAAT,EAAa;AACxB,WAAO,UAAU,EAAV,CAAP;AACD,GAPkB;;AASnB,YAAU,kBAAS,EAAT,EAAa,QAAb,EAAuB;AAC/B,QAAI,MAAM,QAAV,EAAoB;AAClB,gBAAU,EAAV,IAAgB,QAAhB;AACD;AACF,GAbkB;;AAenB,cAAY,oBAAS,EAAT,EAAa;AACvB,QAAI,EAAJ,EAAQ;AACN,gBAAU,EAAV,IAAgB,IAAhB;AACA,aAAO,UAAU,EAAV,CAAP;AACD;AACF,GApBkB;;AAsBnB,cAAY,sBAAW;AACrB,WAAO,aAAa,MAAb,EAAP;AACD,GAxBkB;;AA0BnB,cAAY,EA1BO;;AA4BnB,kBAAgB,0BAAW;AACzB,QAAM,UAAU,aAAa,UAAb,CAAwB,aAAa,UAAb,CAAwB,MAAxB,GAAiC,CAAzD,CAAhB;AACA,QAAI,CAAC,OAAL,EAAc;;AAEd,QAAM,WAAW,aAAa,WAAb,CAAyB,QAAQ,EAAjC,CAAjB;AACA,QAAI,YAAY,SAAS,iBAAzB,EAA4C;AAC1C,eAAS,KAAT;AACD;AACF,GApCkB;;AAsCnB,aAAW,mBAAS,EAAT,EAAa,MAAb,EAAqB,GAArB,EAA0B,UAA1B,EAAsC,SAAtC,EAAiD;AAC1D,QAAI,IAAI,SAAJ,CAAc,SAAlB,EAA6B;AAC7B,QAAI,CAAC,EAAD,IAAO,WAAW,SAAtB,EAAiC;AACjC,SAAK,SAAL,GAAiB,SAAjB;;AAEA,QAAM,aAAa,KAAK,UAAxB;;AAEA,SAAK,IAAI,IAAI,CAAR,EAAW,IAAI,WAAW,MAA/B,EAAuC,IAAI,CAA3C,EAA8C,GAA9C,EAAmD;AACjD,UAAM,OAAO,WAAW,CAAX,CAAb;AACA,UAAI,KAAK,EAAL,KAAY,EAAhB,EAAoB;AAClB;AACD;AACF;;AAED,QAAM,WAAW,UAAjB;;AAEA,aAAS,QAAT,EAAmB,SAAnB;AACA,QAAI,KAAK,SAAL,IAAkB,CAAC,QAAvB,EAAiC;AAC/B,eAAS,QAAT,EAAmB,eAAnB;AACD;AACD,QAAI,UAAJ,EAAgB;AACd,UAAI,WAAW,WAAW,IAAX,GAAkB,KAAlB,CAAwB,KAAxB,CAAf;AACA,eAAS,OAAT,CAAiB;AAAA,eAAQ,SAAS,QAAT,EAAmB,IAAnB,CAAR;AAAA,OAAjB;AACD;AACD,eAAW,YAAM;AACf,kBAAY,QAAZ,EAAsB,eAAtB;AACD,KAFD,EAEG,GAFH;;AAIA,QAAI,OAAO,IAAI,UAAX,IAAyB,IAAI,UAAJ,CAAe,QAAf,KAA4B,EAAzD,EAA6D;AAC3D,UAAI,UAAJ,CAAe,WAAf,CAA2B,QAA3B;AACD,KAFD,MAEO;AACL,eAAS,IAAT,CAAc,WAAd,CAA0B,QAA1B;AACD;;AAED,QAAI,MAAJ,EAAY;AACV,eAAS,KAAT,CAAe,MAAf,GAAwB,MAAxB;AACD;AACD,aAAS,KAAT,CAAe,OAAf,GAAyB,EAAzB;;AAEA,SAAK,UAAL,CAAgB,IAAhB,CAAqB,EAAE,IAAI,EAAN,EAAU,QAAQ,MAAlB,EAA0B,YAAY,UAAtC,EAArB;AACD,GA9EkB;;AAgFnB,cAAY,oBAAS,EAAT,EAAa;AACvB,QAAM,aAAa,KAAK,UAAxB;AACA,QAAM,WAAW,UAAjB;;AAEA,QAAI,WAAW,MAAX,GAAoB,CAAxB,EAA2B;AACzB,UAAM,UAAU,WAAW,WAAW,MAAX,GAAoB,CAA/B,CAAhB;AACA,UAAI,QAAQ,EAAR,KAAe,EAAnB,EAAuB;AACrB,YAAI,QAAQ,UAAZ,EAAwB;AACtB,cAAI,WAAW,QAAQ,UAAR,CAAmB,IAAnB,GAA0B,KAA1B,CAAgC,KAAhC,CAAf;AACA,mBAAS,OAAT,CAAiB;AAAA,mBAAQ,YAAY,QAAZ,EAAsB,IAAtB,CAAR;AAAA,WAAjB;AACD;;AAED,mBAAW,GAAX;AACA,YAAI,WAAW,MAAX,GAAoB,CAAxB,EAA2B;AACzB,mBAAS,KAAT,CAAe,MAAf,GAAwB,WAAW,WAAW,MAAX,GAAoB,CAA/B,EAAkC,MAA1D;AACD;AACF,OAVD,MAUO;AACL,aAAK,IAAI,IAAI,WAAW,MAAX,GAAoB,CAAjC,EAAoC,KAAK,CAAzC,EAA4C,GAA5C,EAAiD;AAC/C,cAAI,WAAW,CAAX,EAAc,EAAd,KAAqB,EAAzB,EAA6B;AAC3B,uBAAW,MAAX,CAAkB,CAAlB,EAAqB,CAArB;AACA;AACD;AACF;AACF;AACF;;AAED,QAAI,WAAW,MAAX,KAAsB,CAA1B,EAA6B;AAC3B,UAAI,KAAK,SAAT,EAAoB;AAClB,iBAAS,QAAT,EAAmB,eAAnB;AACD;AACD,iBAAW,YAAM;AACf,YAAI,WAAW,MAAX,KAAsB,CAA1B,EAA6B;AAC3B,cAAI,SAAS,UAAb,EAAyB,SAAS,UAAT,CAAoB,WAApB,CAAgC,QAAhC;AACzB,mBAAS,KAAT,CAAe,OAAf,GAAyB,MAAzB;AACA,uBAAa,QAAb,GAAwB,SAAxB;AACD;AACD,oBAAY,QAAZ,EAAsB,eAAtB;AACD,OAPD,EAOG,GAPH;AAQD;AACF;AAvHkB,CAArB;;AA0HA,IAAM,cAAc,SAAd,WAAc,GAAW;AAC7B,MAAI,IAAI,SAAJ,CAAc,SAAlB,EAA6B;AAC7B,MAAI,aAAa,UAAb,CAAwB,MAAxB,GAAiC,CAArC,EAAwC;AACtC,QAAM,WAAW,aAAa,UAAb,CAAwB,aAAa,UAAb,CAAwB,MAAxB,GAAiC,CAAzD,CAAjB;AACA,QAAI,CAAC,QAAL,EAAe;AACf,QAAM,WAAW,aAAa,WAAb,CAAyB,SAAS,EAAlC,CAAjB;;AAEA,WAAO,QAAP;AACD;AACF,CATD;;AAWA,IAAI,CAAC,IAAI,SAAJ,CAAc,SAAnB,EAA8B;AAC5B;AACA,SAAO,gBAAP,CAAwB,SAAxB,EAAmC,UAAS,KAAT,EAAgB;AACjD,QAAI,MAAM,OAAN,KAAkB,EAAtB,EAA0B;AACxB,UAAM,WAAW,aAAjB;;AAEA,UAAI,YAAY,SAAS,kBAAzB,EAA6C;AAC3C,iBAAS,WAAT,GACI,SAAS,WAAT,EADJ,GAEK,SAAS,YAAT,GAAwB,SAAS,YAAT,CAAsB,QAAtB,CAAxB,GAA0D,SAAS,KAAT,EAF/D;AAGD;AACF;AACF,GAVD;AAWD;;AAED,eAAe,YAAf","file":"popup-manager-compiled.js","sourcesContent":["import Vue from 'vue';\nimport { addClass, removeClass } from 'element-ui/src/utils/dom';\n\nlet hasModal = false;\n\nconst getModal = function() {\n  if (Vue.prototype.$isServer) return;\n  let modalDom = PopupManager.modalDom;\n  if (modalDom) {\n    hasModal = true;\n  } else {\n    hasModal = false;\n    modalDom = document.createElement('div');\n    PopupManager.modalDom = modalDom;\n\n    modalDom.addEventListener('touchmove', function(event) {\n      event.preventDefault();\n      event.stopPropagation();\n    });\n\n    modalDom.addEventListener('click', function() {\n      PopupManager.doOnModalClick && PopupManager.doOnModalClick();\n    });\n  }\n\n  return modalDom;\n};\n\nconst instances = {};\n\nconst PopupManager = {\n  zIndex: 2000,\n\n  modalFade: true,\n\n  getInstance: function(id) {\n    return instances[id];\n  },\n\n  register: function(id, instance) {\n    if (id && instance) {\n      instances[id] = instance;\n    }\n  },\n\n  deregister: function(id) {\n    if (id) {\n      instances[id] = null;\n      delete instances[id];\n    }\n  },\n\n  nextZIndex: function() {\n    return PopupManager.zIndex++;\n  },\n\n  modalStack: [],\n\n  doOnModalClick: function() {\n    const topItem = PopupManager.modalStack[PopupManager.modalStack.length - 1];\n    if (!topItem) return;\n\n    const instance = PopupManager.getInstance(topItem.id);\n    if (instance && instance.closeOnClickModal) {\n      instance.close();\n    }\n  },\n\n  openModal: function(id, zIndex, dom, modalClass, modalFade) {\n    if (Vue.prototype.$isServer) return;\n    if (!id || zIndex === undefined) return;\n    this.modalFade = modalFade;\n\n    const modalStack = this.modalStack;\n\n    for (let i = 0, j = modalStack.length; i < j; i++) {\n      const item = modalStack[i];\n      if (item.id === id) {\n        return;\n      }\n    }\n\n    const modalDom = getModal();\n\n    addClass(modalDom, 'v-modal');\n    if (this.modalFade && !hasModal) {\n      addClass(modalDom, 'v-modal-enter');\n    }\n    if (modalClass) {\n      let classArr = modalClass.trim().split(/\\s+/);\n      classArr.forEach(item => addClass(modalDom, item));\n    }\n    setTimeout(() => {\n      removeClass(modalDom, 'v-modal-enter');\n    }, 200);\n\n    if (dom && dom.parentNode && dom.parentNode.nodeType !== 11) {\n      dom.parentNode.appendChild(modalDom);\n    } else {\n      document.body.appendChild(modalDom);\n    }\n\n    if (zIndex) {\n      modalDom.style.zIndex = zIndex;\n    }\n    modalDom.style.display = '';\n\n    this.modalStack.push({ id: id, zIndex: zIndex, modalClass: modalClass });\n  },\n\n  closeModal: function(id) {\n    const modalStack = this.modalStack;\n    const modalDom = getModal();\n\n    if (modalStack.length > 0) {\n      const topItem = modalStack[modalStack.length - 1];\n      if (topItem.id === id) {\n        if (topItem.modalClass) {\n          let classArr = topItem.modalClass.trim().split(/\\s+/);\n          classArr.forEach(item => removeClass(modalDom, item));\n        }\n\n        modalStack.pop();\n        if (modalStack.length > 0) {\n          modalDom.style.zIndex = modalStack[modalStack.length - 1].zIndex;\n        }\n      } else {\n        for (let i = modalStack.length - 1; i >= 0; i--) {\n          if (modalStack[i].id === id) {\n            modalStack.splice(i, 1);\n            break;\n          }\n        }\n      }\n    }\n\n    if (modalStack.length === 0) {\n      if (this.modalFade) {\n        addClass(modalDom, 'v-modal-leave');\n      }\n      setTimeout(() => {\n        if (modalStack.length === 0) {\n          if (modalDom.parentNode) modalDom.parentNode.removeChild(modalDom);\n          modalDom.style.display = 'none';\n          PopupManager.modalDom = undefined;\n        }\n        removeClass(modalDom, 'v-modal-leave');\n      }, 200);\n    }\n  }\n};\n\nconst getTopPopup = function() {\n  if (Vue.prototype.$isServer) return;\n  if (PopupManager.modalStack.length > 0) {\n    const topPopup = PopupManager.modalStack[PopupManager.modalStack.length - 1];\n    if (!topPopup) return;\n    const instance = PopupManager.getInstance(topPopup.id);\n\n    return instance;\n  }\n};\n\nif (!Vue.prototype.$isServer) {\n  // handle `esc` key when the popup is shown\n  window.addEventListener('keydown', function(event) {\n    if (event.keyCode === 27) {\n      const topPopup = getTopPopup();\n\n      if (topPopup && topPopup.closeOnPressEscape) {\n        topPopup.handleClose\n          ? topPopup.handleClose()\n          : (topPopup.handleAction ? topPopup.handleAction('cancel') : topPopup.close());\n      }\n    }\n  });\n}\n\nexport default PopupManager;\n"]}