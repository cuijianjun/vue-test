{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _get2 = require('lodash/get');\n\nvar _get3 = _interopRequireDefault(_get2);\n\nvar _sortBy2 = require('lodash/sortBy');\n\nvar _sortBy3 = _interopRequireDefault(_sortBy2);\n\nvar _each2 = require('lodash/each');\n\nvar _each3 = _interopRequireDefault(_each2);\n\nvar _assign3 = require('lodash/assign');\n\nvar _assign4 = _interopRequireDefault(_assign3);\n\nexports.default = lodash;\n\nvar _config = require('./config');\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _importModule3 = require('./importModule');\n\nvar _importModule4 = _interopRequireDefault(_importModule3);\n\nvar _mapping = require('./mapping');\n\nvar _mapping2 = _interopRequireDefault(_mapping);\n\nvar _Store = require('./Store');\n\nvar _Store2 = _interopRequireDefault(_Store);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/** The error message used when chain sequences are detected. */\nvar CHAIN_ERROR = ['Lodash chain sequences are not supported by babel-plugin-lodash.', 'Consider substituting chain sequences with composition patterns.', 'See https://medium.com/making-internets/why-using-chain-is-a-mistake-9bc1f80d51ba'].join('\\n');\n\n/*----------------------------------------------------------------------------*/\n\nfunction lodash(_ref) {\n  var types = _ref.types;\n\n\n  var identifiers = {\n    'PLACEHOLDER': types.identifier('placeholder'),\n    'UNDEFINED': types.identifier('undefined')\n  };\n\n  /**\n   * Used to track variables built during the AST pass. We instantiate these in\n   * the `Program` visitor in order to support running the plugin in watch mode\n   * or on multiple files.\n   *\n   * @type Store\n   */\n  var store = new _Store2.default();\n\n  function getCallee(_ref2) {\n    var parentPath = _ref2.parentPath;\n\n    // Trace curried calls to their origin, e.g. `fp.partial(func)([fp, 2])(1)`.\n    while (!parentPath.isStatement()) {\n      if (parentPath.isCallExpression()) {\n        var result = parentPath.node.callee;\n        while (types.isCallExpression(result)) {\n          result = result.callee;\n        }\n        return result;\n      }\n      parentPath = parentPath.parentPath;\n    }\n  }\n\n  /*--------------------------------------------------------------------------*/\n\n  var visitor = {\n    Program(path, state) {\n      var _assign2 = (0, _assign4.default)(_mapping2.default, (0, _config2.default)(state.opts)),\n          ids = _assign2.ids;\n\n      var file = path.hub.file;\n\n      // Clear tracked method imports.\n\n      _importModule4.default.cache.clear();\n      store.clear();\n\n      // Populate module paths per package.\n      (0, _each3.default)(ids, function (id) {\n        store.set(id);\n        _mapping2.default.modules.get(id).forEach(function (value, key) {\n          store.set(id + '/' + key);\n        });\n      });\n\n      // Replace old members with their method imports.\n      (0, _each3.default)(file.metadata.modules.imports, function (module) {\n        var pkgStore = store.get(module.source);\n        if (!pkgStore) {\n          return;\n        }\n        var isLodash = pkgStore.isLodash();\n        var specs = (0, _sortBy3.default)(module.specifiers, function (spec) {\n          return spec.imported == 'default';\n        });\n\n        (0, _each3.default)(specs, function (spec) {\n          var imported = spec.imported,\n              local = spec.local;\n\n          var binding = file.scope.getBinding(local);\n          var _binding$path$parent$ = binding.path.parent.importKind,\n              importKind = _binding$path$parent$ === undefined ? 'value' : _binding$path$parent$;\n\n          // Skip type annotation specifiers.\n\n          if (importKind != 'value') {\n            return;\n          }\n          var isChain = isLodash && imported == 'chain';\n\n          (0, _each3.default)(binding.referencePaths, function (refPath) {\n            var node = refPath.node,\n                parentPath = refPath.parentPath;\n            var type = node.type;\n\n\n            if (imported && imported != 'default') {\n              if (isChain && refPath.parentPath.isCallExpression()) {\n                throw refPath.buildCodeFrameError(CHAIN_ERROR);\n              }\n\n              var _importModule = (0, _importModule4.default)(pkgStore, imported, refPath),\n                  name = _importModule.name;\n\n              refPath.replaceWith({ type, name });\n            } else if (parentPath.isMemberExpression()) {\n              var key = refPath.parent.property.name;\n              if (isLodash && key == 'chain' && parentPath.parentPath.isCallExpression()) {\n                throw refPath.buildCodeFrameError(CHAIN_ERROR);\n              }\n\n              var _importModule2 = (0, _importModule4.default)(pkgStore, key, refPath),\n                  _name = _importModule2.name;\n\n              parentPath.replaceWith({ type, name: _name });\n            } else if (isLodash) {\n              var callee = getCallee(refPath);\n              if (callee && callee.name == local) {\n                throw refPath.buildCodeFrameError(CHAIN_ERROR);\n              }\n              refPath.replaceWith(callee ? types.memberExpression(callee, identifiers.PLACEHOLDER) : identifiers.UNDEFINED);\n            }\n          });\n        });\n      });\n    },\n\n    ImportDeclaration(path) {\n      if (store.get(path.node.source.value)) {\n        // Remove old import.\n        path.remove();\n      }\n    },\n\n    ExportNamedDeclaration(path) {\n      var node = path.node;\n\n      var pkgPath = (0, _get3.default)(node, 'source.value');\n      var pkgStore = store.get(pkgPath);\n\n      if (!pkgStore) {\n        return;\n      }\n      node.source = null;\n      (0, _each3.default)(node.specifiers, function (spec) {\n        spec.local = (0, _importModule4.default)(pkgStore, spec.local.name, path);\n      });\n    }\n  };\n\n  return { visitor };\n};\nmodule.exports = exports['default'];"]}