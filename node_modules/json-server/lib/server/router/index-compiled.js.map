{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\n\nvar express = require('express');\nvar methodOverride = require('method-override');\nvar _ = require('lodash');\nvar lodashId = require('lodash-id');\nvar low = require('lowdb');\nvar fileAsync = require('lowdb/lib/storages/file-async');\nvar bodyParser = require('../body-parser');\nvar validateData = require('./validate-data');\nvar plural = require('./plural');\nvar nested = require('./nested');\nvar singular = require('./singular');\nvar mixins = require('../mixins');\n\nmodule.exports = function (source) {\n  var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : { foreignKeySuffix: 'Id' };\n\n  // Create router\n  var router = express.Router();\n\n  // Add middlewares\n  router.use(methodOverride());\n  router.use(bodyParser);\n\n  // Create database\n  var db = void 0;\n  if (_.isObject(source)) {\n    db = low();\n    db.setState(source);\n  } else {\n    db = low(source, { storage: fileAsync });\n  }\n\n  validateData(db.getState());\n\n  // Add lodash-id methods to db\n  db._.mixin(lodashId);\n\n  // Add specific mixins\n  db._.mixin(mixins);\n\n  // Expose database\n  router.db = db;\n\n  // Expose render\n  router.render = function (req, res) {\n    res.jsonp(res.locals.data);\n  };\n\n  // GET /db\n  router.get('/db', function (req, res) {\n    res.jsonp(db.getState());\n  });\n\n  // Handle /:parent/:parentId/:resource\n  router.use(nested(opts));\n\n  // Create routes\n  db.forEach(function (value, key) {\n    if (_.isPlainObject(value)) {\n      router.use(`/${key}`, singular(db, key));\n      return;\n    }\n\n    if (_.isArray(value)) {\n      router.use(`/${key}`, plural(db, key, opts));\n      return;\n    }\n\n    var msg = `Type of \"${key}\" (${typeof value}) ${_.isObject(source) ? '' : `in ${source}`} is not supported. ` + `Use objects or arrays of objects.`;\n\n    throw new Error(msg);\n  }).value();\n\n  router.use(function (req, res) {\n    if (!res.locals.data) {\n      res.status(404);\n      res.locals.data = {};\n    }\n\n    router.render(req, res);\n  });\n\n  router.use(function (err, req, res, next) {\n    console.error(err.stack);\n    res.status(500).send(err.stack);\n  });\n\n  return router;\n};"]}