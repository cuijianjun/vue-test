{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["(function () {\n\n  'use strict';\n\n  var assign = require('object-assign');\n  var vary = require('vary');\n\n  var defaults = {\n      origin: '*',\n      methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\n      preflightContinue: false,\n      optionsSuccessStatus: 204\n    };\n\n  function isString(s) {\n    return typeof s === 'string' || s instanceof String;\n  }\n\n  function isOriginAllowed(origin, allowedOrigin) {\n    if (Array.isArray(allowedOrigin)) {\n      for (var i = 0; i < allowedOrigin.length; ++i) {\n        if (isOriginAllowed(origin, allowedOrigin[i])) {\n          return true;\n        }\n      }\n      return false;\n    } else if (isString(allowedOrigin)) {\n      return origin === allowedOrigin;\n    } else if (allowedOrigin instanceof RegExp) {\n      return allowedOrigin.test(origin);\n    } else {\n      return !!allowedOrigin;\n    }\n  }\n\n  function configureOrigin(options, req) {\n    var requestOrigin = req.headers.origin,\n      headers = [],\n      isAllowed;\n\n    if (!options.origin || options.origin === '*') {\n      // allow any origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: '*'\n      }]);\n    } else if (isString(options.origin)) {\n      // fixed origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: options.origin\n      }]);\n      headers.push([{\n        key: 'Vary',\n        value: 'Origin'\n      }]);\n    } else {\n      isAllowed = isOriginAllowed(requestOrigin, options.origin);\n      // reflect origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: isAllowed ? requestOrigin : false\n      }]);\n      headers.push([{\n        key: 'Vary',\n        value: 'Origin'\n      }]);\n    }\n\n    return headers;\n  }\n\n  function configureMethods(options) {\n    var methods = options.methods;\n    if (methods.join) {\n      methods = options.methods.join(','); // .methods is an array, so turn it into a string\n    }\n    return {\n      key: 'Access-Control-Allow-Methods',\n      value: methods\n    };\n  }\n\n  function configureCredentials(options) {\n    if (options.credentials === true) {\n      return {\n        key: 'Access-Control-Allow-Credentials',\n        value: 'true'\n      };\n    }\n    return null;\n  }\n\n  function configureAllowedHeaders(options, req) {\n    var allowedHeaders = options.allowedHeaders || options.headers;\n    var headers = [];\n\n    if (!allowedHeaders) {\n      allowedHeaders = req.headers['access-control-request-headers']; // .headers wasn't specified, so reflect the request headers\n      headers.push([{\n        key: 'Vary',\n        value: 'Access-Control-Request-Headers'\n      }]);\n    } else if (allowedHeaders.join) {\n      allowedHeaders = allowedHeaders.join(','); // .headers is an array, so turn it into a string\n    }\n    if (allowedHeaders && allowedHeaders.length) {\n      headers.push([{\n        key: 'Access-Control-Allow-Headers',\n        value: allowedHeaders\n      }]);\n    }\n\n    return headers;\n  }\n\n  function configureExposedHeaders(options) {\n    var headers = options.exposedHeaders;\n    if (!headers) {\n      return null;\n    } else if (headers.join) {\n      headers = headers.join(','); // .headers is an array, so turn it into a string\n    }\n    if (headers && headers.length) {\n      return {\n        key: 'Access-Control-Expose-Headers',\n        value: headers\n      };\n    }\n    return null;\n  }\n\n  function configureMaxAge(options) {\n    var maxAge = options.maxAge && options.maxAge.toString();\n    if (maxAge && maxAge.length) {\n      return {\n        key: 'Access-Control-Max-Age',\n        value: maxAge\n      };\n    }\n    return null;\n  }\n\n  function applyHeaders(headers, res) {\n    for (var i = 0, n = headers.length; i < n; i++) {\n      var header = headers[i];\n      if (header) {\n        if (Array.isArray(header)) {\n          applyHeaders(header, res);\n        } else if (header.key === 'Vary' && header.value) {\n          vary(res, header.value);\n        } else if (header.value) {\n          res.setHeader(header.key, header.value);\n        }\n      }\n    }\n  }\n\n  function cors(options, req, res, next) {\n    var headers = [],\n      method = req.method && req.method.toUpperCase && req.method.toUpperCase();\n\n    if (method === 'OPTIONS') {\n      // preflight\n      headers.push(configureOrigin(options, req));\n      headers.push(configureCredentials(options, req));\n      headers.push(configureMethods(options, req));\n      headers.push(configureAllowedHeaders(options, req));\n      headers.push(configureMaxAge(options, req));\n      headers.push(configureExposedHeaders(options, req));\n      applyHeaders(headers, res);\n\n      if (options.preflightContinue ) {\n        next();\n      } else {\n        // Safari (and potentially other browsers) need content-length 0,\n        //   for 204 or they just hang waiting for a body\n        res.statusCode = options.optionsSuccessStatus || defaults.optionsSuccessStatus;\n        res.setHeader('Content-Length', '0');\n        res.end();\n      }\n    } else {\n      // actual response\n      headers.push(configureOrigin(options, req));\n      headers.push(configureCredentials(options, req));\n      headers.push(configureExposedHeaders(options, req));\n      applyHeaders(headers, res);\n      next();\n    }\n  }\n\n  function middlewareWrapper(o) {\n    // if options are static (either via defaults or custom options passed in), wrap in a function\n    var optionsCallback = null;\n    if (typeof o === 'function') {\n      optionsCallback = o;\n    } else {\n      optionsCallback = function (req, cb) {\n        cb(null, o);\n      };\n    }\n\n    return function corsMiddleware(req, res, next) {\n      optionsCallback(req, function (err, options) {\n        if (err) {\n          next(err);\n        } else {\n          var corsOptions = assign({}, defaults, options);\n          var originCallback = null;\n          if (corsOptions.origin && typeof corsOptions.origin === 'function') {\n            originCallback = corsOptions.origin;\n          } else if (corsOptions.origin) {\n            originCallback = function (origin, cb) {\n              cb(null, corsOptions.origin);\n            };\n          }\n\n          if (originCallback) {\n            originCallback(req.headers.origin, function (err2, origin) {\n              if (err2 || !origin) {\n                next(err2);\n              } else {\n                corsOptions.origin = origin;\n                cors(corsOptions, req, res, next);\n              }\n            });\n          } else {\n            next();\n          }\n        }\n      });\n    };\n  }\n\n  // can pass either an options hash, an options delegate, or nothing\n  module.exports = middlewareWrapper;\n\n}());\n"]}