{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["// UUID\n// https://gist.github.com/LeverOne/1308368\n/* jshint ignore:start */\nfunction uuid(a,b){for(b=a='';a++<36;b+=a*51&52?(a^15?8^Math.random()*(a^20?16:4):4).toString(16):'-');return b}\n/* jshint ignore:end */\n\nmodule.exports = {\n  // Empties properties\n  __empty: function(doc) {\n    this.forEach(doc, function(value, key) {\n      delete doc[key];\n    });\n  },\n\n  // Copies properties from an object to another\n  __update: function(dest, src) {\n    this.forEach(src, function(value, key) {\n      dest[key] = value;\n    });\n  },\n\n  // Removes an item from an array\n  __remove: function(array, item) {\n    var index = this.indexOf(array, item);\n    if (index != -1) array.splice(index, 1);\n  },\n\n  __id: function() {\n    var id = this.id || 'id';\n    return id;\n  },\n\n  getById: function(collection, id) {\n    var self = this;\n    return this.find(collection, function(doc) {\n      if (self.has(doc, self.__id())) {\n        return doc[self.__id()].toString() === id.toString();\n      }\n    });\n  },\n\n  createId: function(collection, doc) {\n    return uuid();\n  },\n\n  insert: function(collection, doc) {\n    doc[this.__id()] = doc[this.__id()] || this.createId(collection, doc);\n    var d = this.getById(collection, doc[this.__id()]);\n    if (d) throw new Error(\"Insert failed; duplicate id.\");\n    collection.push(doc);\n    return doc;\n  },\n\n  upsert: function(collection, doc) {\n    if (doc[this.__id()]) {\n      // id is set\n      var d = this.getById(collection, doc[this.__id()]);\n      if (d) {\n        // replace properties of existing object\n        this.__empty(d);\n        this.assign(d, doc);\n      } else {\n        // push new object\n        collection.push(doc);\n      }\n    } else {\n      // create id and push new object\n      doc[this.__id()] = this.createId(collection, doc);\n      collection.push(doc);\n    }\n\n    return doc;\n  },\n\n  updateById: function(collection, id, attrs) {\n    var doc = this.getById(collection, id);\n\n    if (doc) {\n      this.assign(doc, attrs, {id: doc.id});\n    }\n\n    return doc;\n  },\n\n  updateWhere: function(collection, predicate, attrs) {\n    var self = this;\n    var docs = this.filter(collection, predicate);\n\n    docs.forEach(function(doc) {\n      self.assign(doc, attrs, {id: doc.id});\n    });\n\n    return docs;\n  },\n\n  replaceById: function(collection, id, attrs) {\n    var doc = this.getById(collection, id);\n\n    if (doc) {\n      var docId = doc.id;\n      this.__empty(doc);\n      this.assign(doc, attrs, {id: docId});\n    }\n\n    return doc;\n  },\n\n  removeById: function(collection, id) {\n    var doc = this.getById(collection, id);\n\n    this.__remove(collection, doc);\n\n    return doc;\n  },\n\n  removeWhere: function(collection, predicate) {\n    var self = this;\n    var docs = this.filter(collection, predicate);\n\n    docs.forEach(function(doc) {\n      self.__remove(collection, doc);\n    });\n\n    return docs;\n  }\n};\n"]}