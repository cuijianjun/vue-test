{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["var url = require('url')\nvar base64 = require('./base64')\n\nvar decodeBase64 = base64.decodeBase64\nvar encodeBase64 = base64.encodeBase64\n\nvar tokenKey = ':_authToken'\nvar userKey = ':username'\nvar passwordKey = ':_password'\n\nmodule.exports = function () {\n  var checkUrl\n  var options\n  if (arguments.length >= 2) {\n    checkUrl = arguments[0]\n    options = arguments[1]\n  } else if (typeof arguments[0] === 'string') {\n    checkUrl = arguments[0]\n  } else {\n    options = arguments[0]\n  }\n  options = options || {}\n  options.npmrc = options.npmrc || require('rc')('npm', {registry: 'https://registry.npmjs.org/'})\n  checkUrl = checkUrl || options.npmrc.registry\n  return getRegistryAuthInfo(checkUrl, options) || getLegacyAuthInfo(options.npmrc)\n}\n\nfunction getRegistryAuthInfo (checkUrl, options) {\n  var parsed = url.parse(checkUrl, false, true)\n  var pathname\n\n  while (pathname !== '/' && parsed.pathname !== pathname) {\n    pathname = parsed.pathname || '/'\n\n    var regUrl = '//' + parsed.host + pathname.replace(/\\/$/, '')\n    var authInfo = getAuthInfoForUrl(regUrl, options.npmrc)\n    if (authInfo) {\n      return authInfo\n    }\n\n    // break if not recursive\n    if (!options.recursive) {\n      return /\\/$/.test(checkUrl)\n        ? undefined\n        : getRegistryAuthInfo(url.resolve(checkUrl, '.'), options)\n    }\n\n    parsed.pathname = url.resolve(normalizePath(pathname), '..') || '/'\n  }\n\n  return undefined\n}\n\nfunction getLegacyAuthInfo (npmrc) {\n  if (npmrc._auth) {\n    return {token: npmrc._auth, type: 'Basic'}\n  }\n  return undefined\n}\n\nfunction normalizePath (path) {\n  return path[path.length - 1] === '/' ? path : path + '/'\n}\n\nfunction getAuthInfoForUrl (regUrl, npmrc) {\n  // try to get bearer token\n  var bearerAuth = getBearerToken(npmrc[regUrl + tokenKey] || npmrc[regUrl + '/' + tokenKey])\n  if (bearerAuth) {\n    return bearerAuth\n  }\n\n  // try to get basic token\n  var username = npmrc[regUrl + userKey] || npmrc[regUrl + '/' + userKey]\n  var password = npmrc[regUrl + passwordKey] || npmrc[regUrl + '/' + passwordKey]\n  var basicAuth = getTokenForUsernameAndPassword(username, password)\n  if (basicAuth) {\n    return basicAuth\n  }\n\n  return undefined\n}\n\nfunction getBearerToken (tok) {\n  if (!tok) {\n    return undefined\n  }\n\n  // check if bearer token\n  var token = tok.replace(/^\\$\\{?([^}]*)\\}?$/, function (fullMatch, envVar) {\n    return process.env[envVar]\n  })\n\n  return {token: token, type: 'Bearer'}\n}\n\nfunction getTokenForUsernameAndPassword (username, password) {\n  if (!username || !password) {\n    return undefined\n  }\n\n  // passwords are base64 encoded, so we need to decode it\n  // See https://github.com/npm/npm/blob/v3.10.6/lib/config/set-credentials-by-uri.js#L26\n  var pass = decodeBase64(password)\n\n  // a basic auth token is base64 encoded 'username:password'\n  // See https://github.com/npm/npm/blob/v3.10.6/lib/config/get-credentials-by-uri.js#L70\n  var token = encodeBase64(username + ':' + pass)\n\n  // we found a basicToken token so let's exit the loop\n  return {\n    token: token,\n    type: 'Basic',\n    password: pass,\n    username: username\n  }\n}\n"]}